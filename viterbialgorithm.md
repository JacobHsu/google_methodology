## 維特比演算法

語音識別基本上分為三步：
第一步是對聲波進行信號處理，得到一些語音特徵；
第二步是通過語音特徵，識別出相應的音節；
第三步是根據音節，合成出完整的語句。

就講從第二步到第三步的過程。為了簡化問題，我們假定第一步和第二步都是完美的，也就是說識別出的音節是100%正確的。當然在現實的各種識別系統中，能做到70%的單個音節識別率就非常好了。事實上我們人的識別率也就是這個水平，我們人之所以能夠聽清楚完整的句子，完全靠的是 **對上下文的理解**，而非音節識別得準。

在漢語中，即使知道了讀音，也就是我們小學學的拼音，要找到準確的對應的漢字還有一些困難，因為漢語中平均一個讀音對應十幾個漢字，漢語是一個二義性或者說歧義性非常強的語言，一個表現就在一音多字上。

`一音多字`這個問題，在語音識別上會產生指數爆炸的災難性後果。比如一個音對應6個字，從理論上講，兩個音的組合就可能對應36個字的組合，一個長度只有十個字的短句子，10個拼音所對應的全部漢字串，能組合出6的十次方，也就是6000萬種可能性。如果句子更長，組合數還會快速增長。

當然，可能有人會說考慮到一些字會組成常用的詞，那麼情況並不會這麼糟糕。這種考慮在語音識別中的確是需要的，通過這種精簡，可以大大減少排列組合的數量。但是，即使每一兩個拼音，只對應少數幾個單字詞或者雙字詞，當句子稍微長一點，組合數量還是大得驚人。我們假定在考慮了組詞之後每個拼音平均對應兩個字，10個音節（拼音）可能的組合只有一千多種，比6000萬種好了很多，但是，如果一句話的長度到了20個音節，可能的組合數量又達到了百萬種。

語音識別其實是一個任務，就是需要在這上百萬的候選中找到最合理、最可能的語句。

## 通信問題

上述問題在通信中也會遇到，是一個標準的解碼問題，那麼怎麼解決這個問題呢？

將一百萬種可能性一一評估顯然不是一個好辦法。對此維特比想到了一個特別妙的解碼辦法。為了比較清楚地說明問題，
我把一句話的拼音和相應的漢字，做一個編號，按照下面的方式放到一張表中。
假如一個句子有20個音節，每個音節可能對應6個字，那麼我們就用一個長為20，深度為6的網格將每個可能的字填入其中。

由於一個句子的音節按順序從頭到尾構成一個時間序列，因此，為了便於描述，我們用t表示音節的時間次序，將第一個音節標記為時間t＝1，最後一個音節標記為時間t＝20。

接下來，我們把每一個音節可以對應的漢字填入到相應的那一列的六個網格中，並且從1到6挨個標記。比如第一個音節對應的字，編號就是從W11，W12，到W16，第二個拼音對應的字，編號為W21，W22，到W26。編號中第一個數字是時間t，後一個數字是某個拼音所對應的六個候選漢字的序號。因此，到了最後一個拼音，即t＝20，相應的字就是W201，W202，到W206。在下面的表格中，我填入了第一個音和第六個音的情況。

所謂的解碼就是在這樣的網格中，找一條從t＝1到t＝20的路徑，路徑中經過的點，就是方格中的一個個字，比如W13，W24，到W201，等等。下圖給出了一條路徑。當然，對於一個20個音節的句子，這樣的路徑有三千六百萬億條。解碼的過程就是找到一條最合理的路徑的過程，我們把它稱為`尋找最佳路徑`。

| t1  |   |   |   |   |   |   | t6  |   |   |   |   |   |   |
|-----|---|---|---|---|---|---|-----|---|---|---|---|---|---|
| W13 |   |   | * |   |   |   | W63 |   |   |   |   |   |   |
| W14 |   | * |   |   |   |   | W64 |   |   |   |   | * |   |
| W15 |   |   |   |   |   |   | W65 |   |   | * |   |   |   |

對於這樣路徑密密麻麻的網格，維特比注意到這樣一個現象：

不論有多少條路徑，最佳的那一條路徑在某個特定時刻，只有六種可能。比如在t＝6（也就是第六個音節）的時刻，必須經過W61，W62，W63......W66，這六個字中的一個。這樣一來在第六個音節之前不論有多少條路徑，真正有可能是最佳路徑的候選路徑，只可能有六條候選。

接下來，進入到第七個音節，由於這個音節也對應了6個漢字，和前面六條路徑組合出6x6=36種可能性
。但是，由於在第七個音節處，最佳的路徑也只可能有六種（和t＝6的情況一樣）。
因此，我們只需要對第七個音節的六個候選，W71，W72，W73......W76，每個候選保留一個最佳路徑即可，這樣一共也是六條。
以此類推，在每個時刻，我們只需要保留六條路徑，將這個步驟一直走到t＝20最後的時刻。

如果對於上述內容你一時難以理解，也沒有關係，只要記住，`在任何時刻，只要保留六條路徑就好`。

這種算法是維特比最早發明的，因此被稱為維特比算法。對於20個音節，每個音節有6個候選字這種情況，

維特比算法將複雜度從6的20次方，即3600萬億，減少到6x6x20=720次，足足減少了20萬億倍。即使考慮到採用了合理的組詞，將每個拼音的候選字限制在兩個，那麼維特比算法也可以將複雜度從1百萬次計算，減少到2x2x20=80次，減少了10000倍。

當然，當年維特比要解決的並不是漢語中一音多字的問題，而是通信傳輸中的糾錯解碼問題。
在數字通信中，0可能在傳輸中被誤傳輸成了1，1可能變成了0，在解碼時，即使看到了1，也要考慮它有一個很小的可能性是0被傳輸錯了產生的，這樣一來，一個長度為N的信息串，就會有2的N次方種可能性。當N很大時，這個數字有多大。對於這樣的解碼，就要用到維特比上面的算法了。

維特比算法從本質上講，是把一種指數複雜度的問題，變成了線性的複雜度。這可能是所有的計算機算法中複雜度下降最大的改進。今天，除了語音識別、機器翻譯、拼音轉漢字、漢語的分詞等用到了維特比算法，各種語言的拼寫糾錯，基因的測序，通信的解碼都要用到它。
